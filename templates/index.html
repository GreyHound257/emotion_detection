<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emotion Detector</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Poppins', sans-serif; background: #f4f4f9; text-align: center; padding: 30px; }
    form { margin-top: 20px; }
    input[type="file"], input[type="text"], button { margin: 10px; padding: 10px; font-size: 1rem; border-radius: 5px; }
    button { background: #222; color: white; border: none; cursor: pointer; }
    img { margin-top: 20px; max-width: 90%; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    video { margin-top: 20px; width: 320px; height: 240px; border-radius: 10px; }
    h1 { font-weight: 700; } h2 { color: #333; }
  </style>
</head>
<body>
  <h1>üé≠ Emotion Detection Web App</h1>

  <form method="POST" action="/predict" enctype="multipart/form-data">
    <input type="text" name="name" placeholder="Enter your name" required /><br>
    <input type="file" name="image" accept="image/*" /><br>

    <p>Or capture live photo:</p>
    <video id="camera" autoplay></video><br>
    <button type="button" onclick="capturePhoto()">üì∏ Capture</button>
    <input type="hidden" name="captured_image" id="captured_image">
    <br><br>

    <button type="submit">Analyze Emotion</button>
  </form>

  {% if prediction %}
    <h2>Detected Emotion: {{ prediction }} ({{ '%.1f'|format(confidence) }}%)</h2>
    <img src="{{ url_for('static', filename='uploads/' + image_file) }}" alt="Uploaded Image" />
  {% endif %}

  <br><a href="/database">üìÅ View Database</a>

  <script>
    const video = document.getElementById('camera');
    const hiddenInput = document.getElementById('captured_image');

    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => video.srcObject = stream);

    function capturePhoto() {
      const canvas = document.createElement('canvas');
      canvas.width = 320;
      canvas.height = 240;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      hiddenInput.value = canvas.toDataURL('image/jpeg');
      alert('üì∏ Photo captured! You can now click "Analyze Emotion".');
    }
  </script>
</body>
</html>
